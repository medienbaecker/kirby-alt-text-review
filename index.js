(function(){"use strict";function r(t,e,a,s,n,d,u,v){var i=typeof t=="function"?t.options:t;return e&&(i.render=e,i.staticRenderFns=a,i._compiled=!0),i._scopeId="data-v-"+d,{exports:t,options:i}}const l={props:{page:{type:Number,default:1}},data(){return{currentImages:{},originalImages:{},saving:{},images:[],pagination:{page:1,pages:1,total:0,limit:100},loading:!1}},computed:{reviewedImagesCount(){return Object.values(this.currentImages).filter(t=>t.alt_reviewed).length},totalImagesCount(){return this.pagination.total},isComplete(){return this.pagination.total>0&&this.reviewedImagesCount===this.pagination.total},hasAnyChanges(){return Object.keys(this.currentImages).some(t=>this.hasChanges(t))},currentLanguage(){return this.$panel.language?this.$panel.language.code:null}},watch:{page(t){this.loadImages(t)},currentLanguage(t,e){if(t!==e&&e!==void 0){if(Object.keys(this.currentImages).some(s=>this.hasChanges(s))&&!confirm(this.$t("medienbaecker.alt-text-review.unsavedChanges")))return;this.loadImages(this.page)}}},created(){this.loadImages(this.page)},mounted(){window.panel.events.on("keydown.cmd.s",this.saveAllChanges)},beforeDestroy(){window.panel.events.off("keydown.cmd.s",this.saveAllChanges)},methods:{async loadImages(t=1){this.loading=!0;try{const e=await this.$api.get("alt-text-review/images",{page:t});this.images=e.images,this.pagination=e.pagination,this.initializeImageData()}catch(e){console.error("Failed to load images:",e),this.$panel.notification.error("Failed to load images")}finally{this.loading=!1}},initializeImageData(){this.currentImages={},this.originalImages={},this.saving={},this.images.forEach(t=>{const e={alt:t.alt,alt_reviewed:t.alt_reviewed};this.$set(this.originalImages,t.id,{...e}),this.$set(this.currentImages,t.id,{...e}),this.$set(this.saving,t.id,!1)})},onPageChange(t){if(Object.keys(this.currentImages).some(s=>this.hasChanges(s))&&!confirm(this.$t("medienbaecker.alt-text-review.unsavedChanges")))return;const a=t.page||t;this.$go(`/alt-text-review/${a}`)},getImageData(t){return this.currentImages[t]||{alt:"",alt_reviewed:!1}},hasChanges(t){const e=this.currentImages[t],a=this.originalImages[t];return!e||!a?!1:e.alt!==a.alt||e.alt_reviewed!==a.alt_reviewed},async saveImage(t){this.$set(this.saving,t,!0);try{const e=this.currentImages[t],a=this.originalImages[t];e.alt!==a.alt&&await this.updateField(t,"alt",e.alt),e.alt_reviewed!==a.alt_reviewed&&await this.updateField(t,"alt_reviewed",e.alt_reviewed?"true":""),this.$set(this.originalImages,t,{...e}),this.$panel.notification.success()}catch(e){this.$panel.notification.error(this.$t("medienbaecker.alt-text-review.error")),console.error(e)}finally{this.$set(this.saving,t,!1)}},async updateField(t,e,a){const s=await this.$api.post("alt-text-review/update",{imageId:t,field:e,value:a});if(s.error)throw new Error(s.error);return s},saveAllChanges(t){t&&t.preventDefault();const e=[];Object.keys(this.currentImages).forEach(a=>{this.hasChanges(a)&&e.push(a)}),e.length!==0&&e.forEach(a=>{this.saveImage(a)})}}};var o=function(){var e=this,a=e._self._c;return a("k-panel-inside",{staticClass:"k-alt-text-review-view"},[a("k-header",{scopedSlots:e._u([{key:"buttons",fn:function(){return[a("k-button",{style:{visibility:e.hasAnyChanges?"visible":"hidden"},attrs:{icon:"check",theme:"orange",variant:"filled",size:"sm"},on:{click:e.saveAllChanges}},[e._v(" "+e._s(e.$t("medienbaecker.alt-text-review.save"))+" ")]),!e.loading&&e.totalImagesCount>0?a("k-button",{attrs:{element:"span",variant:"filled",size:"sm",theme:e.isComplete?"positive":null}},[e._v(" "+e._s(`${e.reviewedImagesCount}/${e.totalImagesCount}`)+" ")]):e._e(),e.currentLanguage?a("k-button",{attrs:{element:"span",variant:"filled",size:"sm"}},[e._v(" "+e._s(e.currentLanguage.toUpperCase())+" ")]):e._e()]},proxy:!0}])},[e._v(" "+e._s(e.$t("medienbaecker.alt-text-review.title"))+" ")]),e.loading?a("div",{staticClass:"k-loader"},[a("k-loader")],1):e.images.length===0?a("div",{staticClass:"k-empty"},[a("k-text",[e._v(e._s(e.$t("medienbaecker.alt-text-review.noImages")))])],1):a("div",[a("k-grid",{staticStyle:{"--columns":"2",gap:"1rem"}},e._l(e.images,function(s){return a("div",{key:s.id,staticClass:"alt-review-card",class:{"alt-review-card--has-changes":e.currentImages[s.id]&&e.hasChanges(s.id)}},[a("k-link",{staticClass:"alt-review-card__image-link",attrs:{to:s.panelUrl}},[a("k-image-frame",{attrs:{src:s.url,alt:e.getImageData(s.id).alt,back:"pattern",ratio:"3/2"}})],1),a("div",{staticClass:"alt-review-card__content"},[a("k-text",{staticClass:"alt-review-card__filename"},[a("strong",[e._v(e._s(s.filename))])]),a("k-text-field",{staticClass:"alt-review-card__alt-input",attrs:{value:e.currentImages[s.id]?e.currentImages[s.id].alt:"",placeholder:e.$t("medienbaecker.alt-text-review.noAltText")},on:{input:function(n){e.currentImages[s.id]&&(e.currentImages[s.id].alt=n)}}}),a("label",{staticClass:"alt-review-card__checkbox"},[a("input",{staticClass:"alt-review-card__checkbox-input",attrs:{type:"checkbox"},domProps:{checked:e.getImageData(s.id).alt_reviewed},on:{change:function(n){return e.$set(e.currentImages[s.id],"alt_reviewed",n.target.checked)}}}),a("span",{staticClass:"alt-review-card__checkbox-label"},[e._v(e._s(e.$t("medienbaecker.alt-text-review.reviewed")))])])],1)],1)}),0),e.pagination.total>e.pagination.limit?a("k-pagination",{staticStyle:{"margin-top":"2rem"},attrs:{page:e.pagination.page,total:e.pagination.total,limit:e.pagination.limit,details:!0},on:{paginate:e.onPageChange}}):e._e()],1)],1)},c=[],g=r(l,o,c,!1,null,"bb628a6a");const h=g.exports;panel.plugin("medienbaecker/alt-text-review",{components:{"k-alt-text-review-view":h}})})();
