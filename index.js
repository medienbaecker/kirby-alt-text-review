(function(){"use strict";function r(a,e,t,i,s,n,g,f){var l=typeof a=="function"?a.options:a;return e&&(l.render=e,l.staticRenderFns=t,l._compiled=!0),l._scopeId="data-v-"+n,{exports:a,options:l}}const o={props:{pageImages:{type:Array,default:()=>[]}},data(){return{currentImages:{},originalImages:{},saving:{}}},created(){this.initializeImageData()},mounted(){window.panel.events.on("keydown.cmd.s",this.saveAllChanges)},beforeDestroy(){window.panel.events.off("keydown.cmd.s",this.saveAllChanges)},methods:{initializeImageData(){this.pageImages.forEach(a=>{a.images.forEach(e=>{const t={alt:e.alt,alt_reviewed:e.alt_reviewed};console.log(`Initializing image ${e.id}:`,{alt:`"${e.alt}"`,alt_reviewed:e.alt_reviewed,altType:typeof e.alt,reviewedType:typeof e.alt_reviewed,filename:e.filename}),this.$set(this.originalImages,e.id,{...t}),this.$set(this.currentImages,e.id,{...t}),this.$set(this.saving,e.id,!1)})})},getImageData(a){return this.currentImages[a]||{alt:"",alt_reviewed:!1}},hasChanges(a){const e=this.currentImages[a],t=this.originalImages[a];if(!e||!t)return!1;const i=e.alt!==t.alt,s=e.alt_reviewed!==t.alt_reviewed,n=i||s;return n&&console.log(`Changes detected for image ${a}:`,{current:{alt:`"${e.alt}"`,alt_reviewed:e.alt_reviewed,altType:typeof e.alt,reviewedType:typeof e.alt_reviewed},original:{alt:`"${t.alt}"`,alt_reviewed:t.alt_reviewed,altType:typeof t.alt,reviewedType:typeof t.alt_reviewed},altChanged:i,reviewedChanged:s}),n},async saveImage(a){this.$set(this.saving,a,!0);try{const e=this.currentImages[a],t=this.originalImages[a];e.alt!==t.alt&&await this.updateField(a,"alt",e.alt),e.alt_reviewed!==t.alt_reviewed&&await this.updateField(a,"alt_reviewed",e.alt_reviewed?"true":""),this.$set(this.originalImages,a,{...e}),this.$panel.notification.success("Changes saved successfully")}catch(e){this.$panel.notification.error("Failed to save changes"),console.error(e)}finally{this.$set(this.saving,a,!1)}},async updateField(a,e,t){const i=await this.$api.post("alt-text-review/update",{imageId:a,field:e,value:t});if(i.error)throw new Error(i.error);return i},saveAllChanges(a){a&&a.preventDefault();const e=[];Object.keys(this.currentImages).forEach(t=>{this.hasChanges(t)&&e.push(t)}),e.length!==0&&e.forEach(t=>{this.saveImage(t)})}}};var d=function(){var e=this,t=e._self._c;return t("k-panel-inside",{staticClass:"k-alt-text-review-view"},[t("k-header",[e._v("Alt Text Review")]),e.pageImages.length===0?t("div",{staticClass:"k-empty"},[t("k-text",[e._v("No images found")])],1):t("div",e._l(e.pageImages,function(i){return t("div",{key:i.pageId,staticClass:"page-section"},[t("k-headline-field",{attrs:{label:i.pageTitle}}),t("div",{staticClass:"image-grid"},e._l(i.images,function(s){return t("div",{key:s.id,staticClass:"image-card",class:{"has-changes":e.hasChanges(s.id)}},[t("k-image-frame",{attrs:{src:s.url,alt:e.getImageData(s.id).alt,back:"pattern",ratio:"3/2"}}),t("div",{staticClass:"image-info"},[t("div",{staticClass:"image-header"},[t("k-text",[t("strong",[e._v(e._s(s.filename))])])],1),t("div",{staticClass:"alt-text-section"},[t("k-input",{attrs:{label:"Alt text",type:"text"},model:{value:e.currentImages[s.id].alt,callback:function(n){e.$set(e.currentImages[s.id],"alt",n)},expression:"currentImages[image.id].alt"}})],1),t("div",{staticClass:"review-actions"},[t("k-toggle-input",{attrs:{text:["Pending","Reviewed"]},model:{value:e.getImageData(s.id).alt_reviewed,callback:function(n){e.$set(e.getImageData(s.id),"alt_reviewed",n)},expression:"getImageData(image.id).alt_reviewed"}}),t("k-button",{class:{"save-button-hidden":!e.hasChanges(s.id)},attrs:{loading:e.saving[s.id],icon:"check",variant:"filled",size:"sm"},on:{click:function(n){return e.saveImage(s.id)}}},[e._v(" Save ")])],1)])],1)}),0)],1)}),0)],1)},c=[],v=r(o,d,c,!1,null,"f9269218");const h=v.exports;panel.plugin("medienbaecker/alt-text-review",{components:{"k-alt-text-review-view":h}})})();
