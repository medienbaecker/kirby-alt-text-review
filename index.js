(function(){"use strict";function l(a,e,t,i,s,r,u,_){var n=typeof a=="function"?a.options:a;return e&&(n.render=e,n.staticRenderFns=t,n._compiled=!0),n._scopeId="data-v-"+r,{exports:a,options:n}}const c={props:{pageImages:{type:Array,default:()=>[]}},data(){return{currentImages:{},originalImages:{},saving:{}}},created(){this.initializeImageData()},mounted(){window.panel.events.on("keydown.cmd.s",this.saveAllChanges)},beforeDestroy(){window.panel.events.off("keydown.cmd.s",this.saveAllChanges)},methods:{initializeImageData(){this.pageImages.forEach(a=>{a.images.forEach(e=>{const t={alt:e.alt,alt_reviewed:e.alt_reviewed};this.$set(this.originalImages,e.id,{...t}),this.$set(this.currentImages,e.id,{...t}),this.$set(this.saving,e.id,!1)})})},getImageData(a){return this.currentImages[a]||{alt:"",alt_reviewed:!1}},hasChanges(a){const e=this.currentImages[a],t=this.originalImages[a];return!e||!t?!1:e.alt!==t.alt||e.alt_reviewed!==t.alt_reviewed},async saveImage(a){this.$set(this.saving,a,!0);try{const e=this.currentImages[a],t=this.originalImages[a];e.alt!==t.alt&&await this.updateField(a,"alt",e.alt),e.alt_reviewed!==t.alt_reviewed&&await this.updateField(a,"alt_reviewed",e.alt_reviewed?"true":""),this.$set(this.originalImages,a,{...e}),this.$panel.notification.success()}catch(e){this.$panel.notification.error("Failed to save changes"),console.error(e)}finally{this.$set(this.saving,a,!1)}},async updateField(a,e,t){const i=await this.$api.post("alt-text-review/update",{imageId:a,field:e,value:t});if(i.error)throw new Error(i.error);return i},saveAllChanges(a){a&&a.preventDefault();const e=[];Object.keys(this.currentImages).forEach(t=>{this.hasChanges(t)&&e.push(t)}),e.length!==0&&e.forEach(t=>{this.saveImage(t)})}}};var o=function(){var e=this,t=e._self._c;return t("k-panel-inside",{staticClass:"k-alt-text-review-view"},[t("k-header",[e._v("Alt Text Review")]),e.pageImages.length===0?t("div",{staticClass:"k-empty"},[t("k-text",[e._v("No images found")])],1):t("div",e._l(e.pageImages,function(i){return t("k-section",{key:i.pageId,attrs:{label:i.pageTitle}},[t("k-grid",{staticStyle:{"--columns":"2",gap:"1rem"}},e._l(i.images,function(s){return t("div",{key:s.id,staticClass:"alt-review-card",class:{"alt-review-card--has-changes":e.hasChanges(s.id)}},[t("k-image-frame",{attrs:{src:s.url,alt:e.getImageData(s.id).alt,back:"pattern",ratio:"3/2"}}),t("div",{staticClass:"alt-review-card__content"},[t("k-text",{staticClass:"alt-review-card__filename"},[t("strong",[e._v(e._s(s.filename))])]),t("k-text-field",{staticClass:"alt-review-card__alt-input",attrs:{value:e.currentImages[s.id].alt,placeholder:"No alt text"},on:{input:function(r){e.currentImages[s.id].alt=r}}}),t("div",{staticClass:"alt-review-card__actions"},[t("label",{staticClass:"alt-review-card__checkbox"},[t("input",{staticClass:"alt-review-card__checkbox-input",attrs:{type:"checkbox"},domProps:{checked:e.getImageData(s.id).alt_reviewed},on:{change:function(r){return e.$set(e.currentImages[s.id],"alt_reviewed",r.target.checked)}}}),t("span",{staticClass:"alt-review-card__checkbox-label"},[e._v("Reviewed")])]),t("k-button",{class:["alt-review-card__save-button",{"alt-review-card__save-button--hidden":!e.hasChanges(s.id)}],attrs:{loading:e.saving[s.id],icon:"check",variant:"filled",size:"sm"},on:{click:function(r){return e.saveImage(s.id)}}},[e._v(" Save ")])],1)],1)],1)}),0)],1)}),1)],1)},d=[],v=l(c,o,d,!1,null,"dae754b8");const h=v.exports;panel.plugin("medienbaecker/alt-text-review",{components:{"k-alt-text-review-view":h}})})();
